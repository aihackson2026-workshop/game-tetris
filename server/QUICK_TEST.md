# 快速测试指南

## 测试实时同步功能

### 准备工作

确保服务器正在运行：
```bash
source ~/.nvm/nvm.sh && PORT=3001 npm start
```

服务器地址：http://localhost:3001

### 测试步骤

#### 1. 打开玩家游戏界面

在浏览器中打开：
```
http://localhost:3001/game.html
```

**操作：**
1. 输入昵称（例如：测试玩家1）
2. 点击"开始游戏"
3. 点击"开始游戏"按钮开始玩
4. 使用键盘操作方块

**键盘操作：**
- `←` 向左移动
- `→` 向右移动
- `↓` 快速下落
- `↑` 旋转方块
- `空格` 直接落下

#### 2. 打开后台管理界面

**在新的浏览器窗口/标签页中打开：**
```
http://localhost:3001/admin.html
```

**操作：**
1. 查看左侧"正在游戏的玩家"列表
2. 找到你刚才注册的玩家（测试玩家1）
3. **点击该玩家卡片**

#### 3. 观察实时同步

**现在你应该看到：**

✅ **游戏画面立即显示** - 看到当前的游戏板和方块

✅ **实时移动同步** - 在玩家窗口按 `←` 或 `→`，后台立即显示方块移动

✅ **旋转同步** - 按 `↑` 旋转方块，后台立即显示旋转效果

✅ **下落同步** - 方块自动下落，后台同步显示

✅ **分数实时更新** - 消除行时，分数立即更新

✅ **流畅的画面** - 没有明显的卡顿或延迟

### 4. 多窗口排列建议

**最佳观看体验：**

```
+-------------------+-------------------+
|   玩家游戏界面    |   后台管理界面    |
|                   |                   |
|   (操作方块)      |   (观看同步)      |
|                   |                   |
+-------------------+-------------------+
```

**分屏方式：**
- Windows: `Win` + `←/→` 快速分屏
- macOS: 拖动窗口到屏幕边缘，或使用分屏功能

### 5. 预期效果验证

#### ✅ 延迟测试
- 在玩家窗口快速按左右键
- 后台画面应该流畅跟随
- **预期延迟：< 100ms**（几乎感觉不到）

#### ✅ 旋转测试
- 在玩家窗口按上箭头旋转
- 后台应立即显示旋转后的形状
- **预期：同步且流畅**

#### ✅ 下落测试
- 观察方块自动下落
- 后台应该平滑跟随
- **预期：每秒钟位置更新 20 次**

#### ✅ 锁定测试
- 让方块落到底部
- 后台应该显示方块锁定
- 新方块出现时同步显示

#### ✅ 消行测试
- 填满一整行
- 后台应该看到：
  - 行被消除
  - 上方方块下落
  - 分数增加

### 6. 多玩家测试

**开启隐私模式/无痕窗口：**

1. **窗口1** - 玩家A（普通窗口）
   ```
   http://localhost:3001/game.html
   昵称：玩家A
   ```

2. **窗口2** - 玩家B（隐私模式）
   ```
   http://localhost:3001/game.html
   昵称：玩家B
   ```

3. **窗口3** - 后台管理
   ```
   http://localhost:3001/admin.html
   ```

**测试：**
- 后台可以看到两个玩家
- 点击玩家A，观看A的游戏
- 切换到玩家B，观看B的游戏
- 验证切换流畅，数据正确

### 7. 性能测试

#### 检查网络流量

**浏览器开发者工具：**
1. 按 `F12` 打开开发者工具
2. 切换到"Network"标签
3. 筛选"WS"（WebSocket）
4. 查看消息频率和大小

**预期：**
- 消息频率：约 20-25 次/秒
- 单条消息：约 1-3 KB
- 总流量：约 50-60 KB/s

#### 检查 CPU 使用

**任务管理器/活动监视器：**
- 浏览器 CPU 使用应该 < 10%
- Node.js 进程 CPU 使用应该 < 5%

### 8. 故障排除

#### 问题：后台看不到玩家

**检查：**
```bash
# 查看服务器日志
tail -f /tmp/tetris-server3.log

# 检查 WebSocket 连接
# 在浏览器控制台查看是否有错误
```

**解决：**
- 刷新后台管理页面
- 确保玩家点击了"开始游戏"

#### 问题：画面不更新

**检查：**
1. 浏览器控制台是否有 WebSocket 错误
2. 是否点击了玩家卡片
3. 玩家是否在游戏中

**解决：**
- 关闭并重新点击玩家
- 刷新后台页面

#### 问题：延迟很大

**检查：**
- 服务器是否正常运行
- 网络连接是否正常
- CPU 是否过载

### 9. 控制台日志

**玩家端控制台应该看到：**
```
WebSocket已连接
```

**后台控制台应该看到：**
```
WebSocket已连接
管理端订阅玩家: player_xxx
```

**服务器日志应该看到：**
```
WebSocket连接建立: type=player, playerId=player_xxx
WebSocket连接建立: type=admin, playerId=null
管理端订阅玩家: player_xxx
```

### 10. 成功标志

如果你看到以下现象，说明实时同步功能运行完美：

✅ 方块移动立即在后台显示
✅ 旋转动作流畅同步
✅ 下落过程平滑连贯
✅ 分数实时更新
✅ 没有明显延迟或卡顿
✅ 多个管理端可以同时观看
✅ 切换玩家流畅无阻

## 额外测试

### 压力测试

模拟多个玩家同时游戏：
```bash
# 开启 5 个浏览器隐私窗口
# 每个窗口打开 game.html
# 所有玩家同时游戏
# 在后台逐个观看
```

### 长时间运行测试

让游戏运行 10 分钟，观察：
- 内存是否稳定
- 连接是否保持
- 性能是否下降

## 总结

通过以上测试，你应该能够完整验证：

1. ✅ 实时同步功能正常工作
2. ✅ 延迟在可接受范围内（< 100ms）
3. ✅ 画面流畅无卡顿
4. ✅ 支持多玩家同时观看
5. ✅ 系统性能稳定

如果所有测试都通过，恭喜！🎉 你的实时俄罗斯方块游戏系统已经完美运行！
