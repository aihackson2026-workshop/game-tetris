<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tetris Game API Demo - LLM Playable</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
        }

        .game-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
        }

        .game-frame-container {
            position: relative;
            width: 100%;
            display: flex;
            justify-content: center;
        }

        #gameFrame {
            width: 100%;
            max-width: 700px;
            height: 700px;
            border: none;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        .control-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .panel {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .panel h2 {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #00d4ff;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
            font-size: 0.9em;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 1em;
        }

        .form-group input:focus {
            outline: none;
            border-color: #00d4ff;
        }

        .btn-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            flex: 1;
            min-width: 80px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,212,255,0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: #000;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,255,136,0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffaa00, #cc8800);
            color: #000;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4466, #cc3355);
            color: #fff;
        }

        .btn-info {
            background: linear-gradient(135deg, #7b2cbf, #5a1f8f);
            color: #fff;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .console {
            background: #0d1117;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.85em;
        }

        .console-line {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 4px;
        }

        .console-line.log {
            background: rgba(0,212,255,0.1);
            color: #00d4ff;
        }

        .console-line.success {
            background: rgba(0,255,136,0.1);
            color: #00ff88;
        }

        .console-line.error {
            background: rgba(255,68,102,0.1);
            color: #ff4466;
        }

        .console-line.info {
            background: rgba(123,44,191,0.1);
            color: #b088d4;
        }

        .state-display {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            font-family: monospace;
            font-size: 0.85em;
            max-height: 400px;
            overflow-y: auto;
        }

        .state-display pre {
            white-space: pre-wrap;
            word-break: break-all;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .quick-actions .btn {
            padding: 10px;
            font-size: 0.85em;
        }

        .captcha-section {
            display: none;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin-top: 15px;
        }

        .captcha-section.active {
            display: block;
        }

        .captcha-section h3 {
            color: #ffaa00;
            margin-bottom: 15px;
        }

        .captcha-image {
            display: block;
            max-width: 200px;
            margin: 15px auto;
            border: 2px solid #ffaa00;
            border-radius: 8px;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }

        .tab {
            padding: 8px 16px;
            background: transparent;
            border: none;
            color: #888;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .tab.active {
            background: rgba(0,212,255,0.2);
            color: #00d4ff;
        }

        .tab:hover {
            color: #fff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .doc-section {
            margin-bottom: 20px;
        }

        .doc-section h3 {
            color: #00d4ff;
            margin-bottom: 10px;
        }

        .doc-section p {
            color: #aaa;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .code-block {
            background: #0d1117;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.85em;
            overflow-x: auto;
            color: #c9d1d9;
            margin: 10px 0;
        }

        .api-list {
            list-style: none;
        }

        .api-list li {
            padding: 10px;
            background: rgba(0,0,0,0.2);
            margin-bottom: 8px;
            border-radius: 6px;
            border-left: 3px solid #00d4ff;
        }

        .api-list li strong {
            color: #00d4ff;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.connected {
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
        }

        .status-indicator.disconnected {
            background: #ff4466;
            box-shadow: 0 0 10px #ff4466;
        }

        .keyboard-hint {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .keyboard-hint span {
            font-size: 0.8em;
            color: #666;
        }

        .keyboard-hint kbd {
            background: rgba(255,255,255,0.1);
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® Tetris Game API Demo</h1>
        <p class="subtitle">LLM å¯ç¼–ç¨‹ä¿„ç½—æ–¯æ–¹å— - é€šè¿‡ API æ§åˆ¶æ¸¸æˆ</p>

        <div class="main-content">
            <div class="game-section">
                <div class="game-frame-container">
                    <iframe id="gameFrame" src="http://127.0.0.1:3001/game.html"></iframe>
                </div>

                <!-- CAPTCHA Section -->
                <div class="captcha-section" id="captchaSection">
                    <h3>âš ï¸ äººæœºéªŒè¯</h3>
                    <p>è¯·è¾“å…¥å›¾ç‰‡ä¸­çš„éªŒè¯ç ä»¥ç»§ç»­æ¸¸æˆ</p>
                    <img id="captchaImage" class="captcha-image" src="" alt="éªŒè¯ç ">
                    <div class="form-group">
                        <input type="text" id="captchaInput" maxlength="4" placeholder="è¾“å…¥éªŒè¯ç ">
                    </div>
                    <div class="btn-row">
                        <button class="btn btn-warning" onclick="submitCaptcha()">æäº¤éªŒè¯</button>
                        <button class="btn btn-info" onclick="refreshCaptcha()">åˆ·æ–°éªŒè¯ç </button>
                    </div>
                    <p id="captchaError" style="color: #ff4466; margin-top: 10px;"></p>
                </div>
            </div>

            <div class="control-section">
                <!-- Connection Status -->
                <div class="panel">
                    <h2>
                        <span class="status-indicator disconnected" id="statusIndicator"></span>
                        <span id="statusText">æœªè¿æ¥</span>
                    </h2>
                    <div class="btn-row" style="margin-top: 15px;">
                        <button class="btn btn-primary" id="initSdkBtn" onclick="initSDK()">åˆå§‹åŒ– SDK</button>
                        <button class="btn btn-success" id="startAutoPlayBtn" onclick="startAutoPlay()">è‡ªåŠ¨æ¼”ç¤º</button>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="panel">
                    <h2>æ¸¸æˆæ§åˆ¶</h2>
                    <p style="color: #888; font-size: 0.9em; margin-bottom: 15px;">
                        è¯·å…ˆåœ¨æ¸¸æˆå†…æ³¨å†Œ/ç™»å½•å¼€å§‹æ¸¸æˆï¼Œç„¶åä½¿ç”¨ä¸‹æ–¹æŒ‰é’®æˆ–é”®ç›˜æ§åˆ¶
                    </p>
                    <div class="quick-actions">
                        <button class="btn btn-primary" onclick="moveLeft()">â† å·¦ç§»</button>
                        <button class="btn btn-primary" onclick="moveRight()">å³ç§» â†’</button>
                        <button class="btn btn-primary" onclick="moveDown()">â†“ ä¸‹è½</button>
                        <button class="btn btn-warning" onclick="hardDrop()">è½åˆ°åº•</button>
                        <button class="btn btn-info" onclick="rotate()">â†» æ—‹è½¬</button>
                    </div>
                    <div class="quick-actions" style="margin-top: 10px;">
                        <button class="btn btn-success" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
                        <button class="btn btn-danger" onclick="endGame()">ç»“æŸæ¸¸æˆ</button>
                    </div>
                    <div class="quick-actions" style="margin-top: 10px;">
                        <button class="btn btn-warning" onclick="pauseGame()">æš‚åœæ¸¸æˆ</button>
                        <button class="btn btn-primary" onclick="resumeGame()">ç»§ç»­æ¸¸æˆ</button>
                    </div>
                    <div class="keyboard-hint">
                        <span><kbd>Q</kbd> å·¦ç§»</span>
                        <span><kbd>E</kbd> å³ç§»</span>
                        <span><kbd>S</kbd> ä¸‹è½</span>
                        <span><kbd>ç©ºæ ¼</kbd> è½åˆ°åº•</span>
                        <span><kbd>W</kbd> æ—‹è½¬</span>
                        <span><kbd>Enter</kbd> å¼€å§‹</span>
                        <span><kbd>P</kbd> æš‚åœ</span>
                        <span><kbd>Esc</kbd> ç»“æŸ</span>
                    </div>
                </div>

                <!-- State Display -->
                <div class="panel">
                    <h2>æ¸¸æˆçŠ¶æ€</h2>
                    <div class="state-display" id="stateDisplay">
                        <pre id="stateContent">ç­‰å¾…åˆå§‹åŒ–...</pre>
                    </div>
                    <div class="btn-row" style="margin-top: 10px;">
                        <button class="btn btn-info" onclick="refreshState()">åˆ·æ–°çŠ¶æ€</button>
                        <button class="btn btn-info" onclick="getBoardState()">æŸ¥çœ‹æ£‹ç›˜</button>
                    </div>
                </div>

                <!-- Console -->
                <div class="panel">
                    <h2>æ§åˆ¶å°è¾“å‡º</h2>
                    <div class="console" id="console">
                        <div class="console-line info">ç³»ç»Ÿå°±ç»ªï¼Œè¯·åˆå§‹åŒ– SDK</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Documentation -->
        <div class="panel" style="margin-top: 20px;">
            <div class="tabs">
                <button class="tab active" onclick="showDoc('overview', event)">æ¦‚è¿°</button>
                <button class="tab" onclick="showDoc('api', event)">API å‚è€ƒ</button>
                <button class="tab" onclick="showDoc('example', event)">ä»£ç ç¤ºä¾‹</button>
                <button class="tab" onclick="showDoc('coordinates', event)">åæ ‡ç³»</button>
            </div>

            <div id="doc-overview" class="tab-content active">
                <div class="doc-section">
                    <h3>ğŸ® Tetris Game API æ¦‚è¿°</h3>
                    <p>è¿™æ˜¯ä¸€ä¸ªå¯ä»¥è®©å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰é€šè¿‡ JavaScript API æ§åˆ¶ä¿„ç½—æ–¯æ–¹å—æ¸¸æˆçš„æ¥å£ã€‚é€šè¿‡è¿™ä¸ª APIï¼Œä½ å¯ä»¥ï¼š</p>
                    <ul style="margin: 15px 0; padding-left: 20px; color: #aaa; line-height: 2;">
                        <li>æŸ¥è¯¢æ¸¸æˆçŠ¶æ€ï¼ˆæ£‹ç›˜ã€åˆ†æ•°ã€æ–¹å—ç­‰ï¼‰</li>
                        <li>æ§åˆ¶æ–¹å—ç§»åŠ¨ã€æ—‹è½¬ã€è½ä¸‹</li>
                        <li>å¤„ç†äººæœºéªŒè¯æŒ‘æˆ˜</li>
                        <li>ç›‘å¬æ¸¸æˆäº‹ä»¶ï¼ˆæ¸¸æˆç»“æŸã€åˆ†æ•°å˜åŒ–ç­‰ï¼‰</li>
                    </ul>
                    <p style="color: #888;">
                        <strong>å·¥ä½œåŸç†ï¼š</strong>æ¸¸æˆè¿è¡Œåœ¨ iframe ä¸­ï¼ŒSDK é€šè¿‡ postMessage ä¸æ¸¸æˆé€šä¿¡ã€‚ç©å®¶æ³¨å†Œ/ç™»å½•åœ¨æ¸¸æˆå†…ç•Œé¢å®Œæˆã€‚
                    </p>
                </div>

                <div class="doc-section">
                    <h3>ğŸš€ å¿«é€Ÿå¼€å§‹</h3>
                    <p>åªéœ€ 3 è¡Œä»£ç å³å¯å¼€å§‹æ§åˆ¶æ¸¸æˆï¼š</p>
                    <div class="code-block">
const tetris = new TetrisGameSDK(document.getElementById('gameFrame'));
await tetris.init();
const state = await tetris.getGameState();
console.log('å½“å‰åˆ†æ•°:', state.score);</div>
                    <p style="color: #888; margin-top: 10px;">
                        æ³¨æ„ï¼šç©å®¶æ³¨å†Œ/ç™»å½•éœ€åœ¨æ¸¸æˆå†…ç•Œé¢å®Œæˆï¼ŒSDK ä»…ç”¨äºæŸ¥è¯¢çŠ¶æ€å’Œæ§åˆ¶æ¸¸æˆ
                    </p>
                </div>

                <div class="doc-section">
                    <h3>ğŸ“‹ åµŒå…¥æ¸¸æˆ</h3>
                    <div class="code-block">
&lt;iframe id="gameFrame" src="http://localhost:3001/game.html" width="700" height="700"&gt;&lt;/iframe&gt;
&lt;script src="http://localhost:3001/tetris-sdk.js"&gt;&lt;/script&gt;</div>
                </div>
            </div>

            <div id="doc-api" class="tab-content">
                <div class="doc-section">
                    <h3>ğŸ“– API æ–¹æ³•åˆ—è¡¨</h3>
                    <ul class="api-list">
                        <li><strong>init()</strong> - åˆå§‹åŒ– SDKï¼Œè¿æ¥æ¸¸æˆ</li>
                        <li><strong>getGameState()</strong> - è·å–å®Œæ•´æ¸¸æˆçŠ¶æ€</li>
                        <li><strong>getBoardState()</strong> - è·å–æ£‹ç›˜è¯¦ç»†çŠ¶æ€</li>
                        <li><strong>moveLeft()</strong> - æ–¹å—å·¦ç§»</li>
                        <li><strong>moveRight()</strong> - æ–¹å—å³ç§»</li>
                        <li><strong>moveDown()</strong> - æ–¹å—ä¸‹ç§»</li>
                        <li><strong>hardDrop()</strong> - æ–¹å—ç›´æ¥è½åˆ°åº•</li>
                        <li><strong>rotate()</strong> - æ—‹è½¬æ–¹å—</li>
                        <li><strong>submitCaptcha(captchaId, code)</strong> - æäº¤éªŒè¯ç </li>
                        <li><strong>on(event, callback)</strong> - ç›‘å¬æ¸¸æˆäº‹ä»¶</li>
                    </ul>
                    <p style="color: #888; font-size: 0.9em; margin-top: 15px;">
                        <strong>æ³¨æ„ï¼š</strong>ç©å®¶æ³¨å†Œ/ç™»å½•è¯·åœ¨æ¸¸æˆå†…ç•Œé¢å®Œæˆ
                    </p>
                </div>

                <div class="doc-section">
                    <h3>ğŸ“Š çŠ¶æ€å“åº”æ ¼å¼</h3>
                    <p>getGameState() è¿”å›ï¼š</p>
                    <div class="code-block">
{
    status: "playing",      // playing | finished | waiting
    score: 0,               // å½“å‰åˆ†æ•°
    lines: 0,               // æ¶ˆé™¤è¡Œæ•°
    level: 1,               // å½“å‰ç­‰çº§
    currentScore: 0,
    highestScore: 5000,     // å†å²æœ€é«˜åˆ†
    board: [...],           // 20x10 æ£‹ç›˜æ•°ç»„
    currentPiece: {...},    // å½“å‰ä¸‹è½æ–¹å—
    nextPiece: {...},       // ä¸‹ä¸€ä¸ªæ–¹å—
    captchaRequired: false, // æ˜¯å¦éœ€è¦éªŒè¯ç 
    captchaId: null         // éªŒè¯ç  ID
}</div>
                </div>

                <div class="doc-section">
                    <h3>ğŸ¯ æ–¹å—ç±»å‹</h3>
                    <p>æ£‹ç›˜æ–¹å—ç±»å‹ï¼š<strong>I, O, T, S, Z, J, L</strong></p>
                    <div class="code-block" style="margin-top: 15px;">
I (é’è‰²):   O (é»„è‰²):   T (ç´«è‰²):   S (ç»¿è‰²):   Z (çº¢è‰²):   J (è“è‰²):   L (æ©™è‰²):
####       ##         .#.        .##        ##.        #..        ..#
####       ##         ###        ##.        .##        ###        ###
                                           ..#        #..
                                           #..
æ³¨æ„ï¼š# è¡¨ç¤ºæ–¹å—ï¼Œ. è¡¨ç¤ºç©ºç™½
                    </div>
                    <p style="margin-top: 10px; color: #888; font-size: 0.9em;">
                        æ‰€æœ‰æ–¹å—å›´ç»•å·¦ä¸Šè§’æ—‹è½¬ 90Â°
                    </p>
                </div>

                <div class="doc-section">
                    <h3>ğŸ¯ currentPiece.shape æ—‹è½¬çŸ©é˜µ</h3>
                    <p>æ–¹å—çš„ <code>shape</code> æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œè¡¨ç¤ºå½“å‰çš„æ—‹è½¬çŠ¶æ€ï¼š</p>
                    <div class="code-block">
// å½¢çŠ¶ç¤ºä¾‹ T æ–¹å—
shape: [[0,1,0],  // ç¬¬0è¡Œ: .#.
        [1,1,1]]  // ç¬¬1è¡Œ: ###

// æ—‹è½¬90Â°å
shape: [[1,0],    // ç¬¬0è¡Œ: #.
        [1,1],    // ç¬¬1è¡Œ: ##
        [1,0]]    // ç¬¬2è¡Œ: #.

// ä½¿ç”¨ shape åˆ¤æ–­æ–¹å‘
const rows = piece.shape.length;
const cols = piece.shape[0].length;
console.log(`æ–¹å—å°ºå¯¸: ${cols}x${rows}`);

// I å‹æ–¹å—æ¨ªæ”¾ (4x1)
shape: [[1,1,1,1]]

// I å‹æ–¹å—ç«–æ”¾ (1x4)
shape: [[1],
        [1],
        [1],
        [1]]
                    </div>
                    <p style="margin-top: 10px; color: #888; font-size: 0.9em;">
                        æ•°ç»„ä¸­çš„ 1 è¡¨ç¤ºæ–¹å—ä½ç½®ï¼Œ0 è¡¨ç¤ºç©ºç™½ã€‚æ—‹è½¬æ—¶ä¼šç›´æ¥ä¿®æ”¹æ­¤çŸ©é˜µã€‚
                    </p>
                </div>
            </div>

            <div id="doc-example" class="tab-content">
                <div class="doc-section">
                    <h3>ğŸ¤– ç®€å• AI ç¤ºä¾‹</h3>
                    <p>ä¸€ä¸ªèƒ½è‡ªåŠ¨ç©ä¿„ç½—æ–¯æ–¹å—çš„ç®€å• AIï¼š</p>
                    <div class="code-block">
const iframe = document.getElementById('gameFrame');
const tetris = new TetrisGameSDK(iframe);

async function runBot() {
    await tetris.init();
    
    while (true) {
        const state = await tetris.getGameState();
        
        if (state.status !== 'playing') {
            // ç­‰å¾…ç©å®¶åœ¨æ¸¸æˆå†…æ³¨å†Œå¹¶å¼€å§‹
            console.log('ç­‰å¾…æ¸¸æˆå¼€å§‹...');
            await delay(2000);
            continue;
        }
        
        if (state.captchaRequired) {
            await handleCaptcha(state.captchaId);
            continue;
        }
        
        // AI å†³ç­–ï¼šç®€å•çš„ç­–ç•¥
        const decision = analyzeState(state);
        
        switch (decision) {
            case 'left': await tetris.moveLeft(); break;
            case 'right': await tetris.moveRight(); break;
            case 'down': await tetris.moveDown(); break;
            case 'drop': await tetris.hardDrop(); break;
            case 'rotate': await tetris.rotate(); break;
        }
        
        await delay(200); // æ¨¡æ‹Ÿäººç±»é€Ÿåº¦
    }
}

function analyzeState(state) {
    // è¿™é‡Œå®ç°ä½ çš„ AI ç­–ç•¥
    return 'down'; // é»˜è®¤ä¸‹ç§»
}

function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

runBot();</div>
                    <p style="color: #888; font-size: 0.9em; margin-top: 10px;">
                        æç¤ºï¼šè¯·å…ˆåœ¨æ¸¸æˆå†…å®Œæˆæ³¨å†Œ/ç™»å½•ï¼ŒAI ä¼šåœ¨æ¸¸æˆå¼€å§‹åè‡ªåŠ¨æ¥ç®¡
                    </p>
                </div>

                <div class="doc-section">
                    <h3>ğŸ“ äº‹ä»¶ç›‘å¬ç¤ºä¾‹</h3>
                    <div class="code-block">
// ç›‘å¬æ¸¸æˆç»“æŸ
tetris.on('gameOver', (data) => {
    console.log(`æ¸¸æˆç»“æŸï¼å¾—åˆ†: ${data.score}, æ’å: ${data.rank}`);
});

// ç›‘å¬åˆ†æ•°æ›´æ–°
tetris.on('scoreUpdate', (data) => {
    console.log(`åˆ†æ•°: ${data.score}, ç­‰çº§: ${data.level}`);
});

// ç›‘å¬éªŒè¯ç æŒ‘æˆ˜
tetris.on('captchaRequired', (data) => {
    console.log('éœ€è¦éªŒè¯ç :', data.captchaId);
    const imageUrl = tetris.getCaptchaImageUrl(data.captchaId);
    // ä½¿ç”¨ OCR è¯†åˆ«æˆ–äººå·¥è¾“å…¥
});</div>
                </div>
            </div>

            <div id="doc-coordinates" class="tab-content">
                <div class="doc-section">
                    <h3>ğŸ“ åæ ‡ç³»è¯´æ˜</h3>
                    <p>æ¸¸æˆæ£‹ç›˜å¤§å°ï¼š<strong>20 è¡Œ Ã— 10 åˆ—</strong></p>
                    <div class="code-block">
åæ ‡ç³» (x, y)ï¼š
    (0,0) â”€â”€â”€â”€â”€â”€â–º X è½´ (0-9)
       â”‚
       â”‚
       â”‚
       â–¼ Y è½´ (0-19)

è¡Œ 0: æ£‹ç›˜é¡¶éƒ¨
è¡Œ 19: æ£‹ç›˜åº•éƒ¨

åˆ— 0: å·¦ä¾§è¾¹ç¼˜
åˆ— 9: å³ä¾§è¾¹ç¼˜

æ–¹å—ä½ç½® (x, y)ï¼š
- x: æ°´å¹³ä½ç½®ï¼ˆåˆ—ç´¢å¼•ï¼‰
- y: å‚ç›´ä½ç½®ï¼ˆè¡Œç´¢å¼•ï¼Œå‘ä¸‹é€’å¢ï¼‰

ç¤ºä¾‹ï¼šæ–¹å—åœ¨ä½ç½® {x: 3, y: 5}
æ„å‘³ç€æ–¹å—å½¢çŠ¶çŸ©é˜µä»ç¬¬5è¡Œã€ç¬¬3åˆ—å¼€å§‹</div>
                </div>

                <div class="doc-section">
                    <h3>ğŸ”„ æ–¹å—æ—‹è½¬</h3>
                    <p>æ–¹å—é¡ºæ—¶é’ˆæ—‹è½¬ 90 åº¦ï¼Œä½ç½®ä¿æŒä¸å˜ï¼š</p>
                    <div class="code-block">
æ—‹è½¬å‰ï¼š              æ—‹è½¬åï¼š
[[0,1,0],            [[0,0,1],
 [1,1,1],     â†’       [1,1,1],
 [0,0,0]]             [0,0,1]]

å¦‚æœæ—‹è½¬å¯¼è‡´ç¢°æ’ï¼Œæ–¹å—ä¿æŒåŸä½ä¸å˜</div>
                </div>

                <div class="doc-section">
                    <h3>ğŸ“ è¿”å›å€¼è¯´æ˜</h3>
                    <p>ç§»åŠ¨æ“ä½œè¿”å›ï¼š</p>
                    <div class="code-block">
{
    success: true,   // æ˜¯å¦æˆåŠŸç§»åŠ¨
    x: 3,            // æ–°çš„ X ä½ç½®ï¼ˆå·¦å³ç§»åŠ¨ï¼‰
    y: 5             // æ–°çš„ Y ä½ç½®ï¼ˆä¸‹è½ï¼‰
}

å¦‚æœ success ä¸º falseï¼Œè¡¨ç¤ºç¢°æ’æˆ–è¾¹ç•Œé˜»æŒ¡ï¼Œæ–¹å—ä½ç½®ä¸å˜</div>
                </div>
            </div>
        </div>
    </div>

    <script src="tetris-sdk.js"></script>
    <script>
        // Global variables
        let tetris = null;
        let currentCaptchaId = null;
        let isSdkReady = false;

        // Console logging
        function log(message, type = 'log') {
            const consoleEl = document.getElementById('console');
            const line = document.createElement('div');
            line.className = `console-line ${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleEl.appendChild(line);
            consoleEl.scrollTop = consoleEl.scrollHeight;
            console.log(message);
        }

        function showDoc(sectionId, evt) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            (evt || event).target.classList.add('active');
            document.getElementById('doc-' + sectionId).classList.add('active');
        }

        // Initialize SDK
        async function initSDK() {
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            try {
                const iframe = document.getElementById('gameFrame');
                tetris = new TetrisGameSDK(iframe);
                
                log('æ­£åœ¨åˆå§‹åŒ– SDK...', 'info');
                statusText.textContent = 'åˆå§‹åŒ–ä¸­...';
                
                await tetris.init();
                isSdkReady = true;
                
                statusIndicator.className = 'status-indicator connected';
                statusText.textContent = 'å·²è¿æ¥';
                
                log('SDK åˆå§‹åŒ–æˆåŠŸï¼', 'success');
                
                // Set up event listeners
                setupEventListeners();
                
                // Refresh initial state
                refreshState();
            } catch (error) {
                log('SDK åˆå§‹åŒ–å¤±è´¥: ' + error.message, 'error');
                statusIndicator.className = 'status-indicator disconnected';
                statusText.textContent = 'è¿æ¥å¤±è´¥';
            }
        }

        // Movement functions
        async function moveLeft() {
            if (!isSdkReady) return log('è¯·å…ˆåˆå§‹åŒ– SDK', 'error');
            try {
                const result = await tetris.moveLeft();
                log(`å·¦ç§»: ${result.success ? 'æˆåŠŸ' : 'å¤±è´¥'}`, result.success ? 'success' : 'error');
                refreshState();
            } catch (error) {
                log('å·¦ç§»å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function moveRight() {
            if (!isSdkReady) return log('è¯·å…ˆåˆå§‹åŒ– SDK', 'error');
            try {
                const result = await tetris.moveRight();
                log(`å³ç§»: ${result.success ? 'æˆåŠŸ' : 'å¤±è´¥'}`, result.success ? 'success' : 'error');
                refreshState();
            } catch (error) {
                log('å³ç§»å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function moveDown() {
            if (!isSdkReady) return log('è¯·å…ˆåˆå§‹åŒ– SDK', 'error');
            try {
                const result = await tetris.moveDown();
                log(`ä¸‹è½: ${result.success ? 'æˆåŠŸ' : 'å¤±è´¥'}`, result.success ? 'success' : 'error');
                refreshState();
            } catch (error) {
                log('ä¸‹è½å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function hardDrop() {
            if (!isSdkReady) return log('è¯·å…ˆåˆå§‹åŒ– SDK', 'error');
            try {
                const result = await tetris.hardDrop();
                log(`ç¡¬è½ä¸‹: ${result.success ? 'æˆåŠŸ' : 'å¤±è´¥'}`, result.success ? 'success' : 'error');
                refreshState();
            } catch (error) {
                log('ç¡¬è½ä¸‹å¤±è´¥: ' + error.message, 'error');
            }
        }

        async function rotate() {
            if (!isSdkReady) return log('è¯·å…ˆåˆå§‹åŒ– SDK', 'error');
            try {
                const result = await tetris.rotate();
                log(`æ—‹è½¬: ${result.success ? 'æˆåŠŸ' : 'å¤±è´¥'}`, result.success ? 'success' : 'error');
                refreshState();
            } catch (error) {
                log('æ—‹è½¬å¤±è´¥: ' + error.message, 'error');
            }
        }

        // Start game
        async function startGame() {
            if (!isSdkReady) return log('è¯·å…ˆåˆå§‹åŒ– SDK', 'error');
            try {
                const result = await tetris.startGame();
                log('æ¸¸æˆå·²å¼€å§‹', 'success');
                refreshState();
            } catch (error) {
                log('å¼€å§‹æ¸¸æˆå¤±è´¥: ' + error.message, 'error');
            }
        }

        // End game
        async function endGame() {
            if (!isSdkReady) return log('è¯·å…ˆåˆå§‹åŒ– SDK', 'error');
            try {
                const result = await tetris.endGame();
                log('æ¸¸æˆå·²ç»“æŸ', 'info');
                refreshState();
            } catch (error) {
                log('ç»“æŸæ¸¸æˆå¤±è´¥: ' + error.message, 'error');
            }
        }

        // Pause game
        async function pauseGame() {
            if (!isSdkReady) return log('è¯·å…ˆåˆå§‹åŒ– SDK', 'error');
            try {
                const result = await tetris.pauseGame();
                log('æ¸¸æˆå·²æš‚åœ', 'warning');
                refreshState();
            } catch (error) {
                log('æš‚åœå¤±è´¥: ' + error.message, 'error');
            }
        }

        // Resume game
        async function resumeGame() {
            if (!isSdkReady) return log('è¯·å…ˆåˆå§‹åŒ– SDK', 'error');
            try {
                const result = await tetris.resumeGame();
                log('æ¸¸æˆå·²ç»§ç»­', 'success');
                refreshState();
            } catch (error) {
                log('ç»§ç»­å¤±è´¥: ' + error.message, 'error');
            }
        }

        // Restart game - removed, replaced with startGame/endGame
        function restartGame() {
            log('è¯·ä½¿ç”¨"å¼€å§‹æ¸¸æˆ"å’Œ"ç»“æŸæ¸¸æˆ"æŒ‰é’®', 'info');
        }

        // Refresh state display
        async function refreshState() {
            if (!isSdkReady) {
                document.getElementById('stateContent').textContent = 'ç­‰å¾…åˆå§‹åŒ–...';
                return;
            }
            
            try {
                const state = await tetris.getGameState();
                document.getElementById('stateContent').textContent = JSON.stringify(state, null, 2);
                
                // Handle CAPTCHA display
                const captchaSection = document.getElementById('captchaSection');
                if (state.captchaRequired) {
                    captchaSection.classList.add('active');
                    currentCaptchaId = state.captchaId;
                    document.getElementById('captchaInput').value = '';
                    document.getElementById('captchaError').textContent = '';
                    document.getElementById('captchaImage').src = tetris.getCaptchaImageUrl(state.captchaId);
                    log('éœ€è¦äººæœºéªŒè¯ï¼', 'warning');
                } else {
                    captchaSection.classList.remove('active');
                }
            } catch (error) {
                log('è·å–çŠ¶æ€å¤±è´¥: ' + error.message, 'error');
            }
        }

        // Get detailed board state
        async function getBoardState() {
            if (!isSdkReady) return log('è¯·å…ˆåˆå§‹åŒ– SDK', 'error');
            
            try {
                const state = await tetris.getBoardState();
                log('è·å–åˆ°æ£‹ç›˜çŠ¶æ€', 'success');
                document.getElementById('stateContent').textContent = JSON.stringify(state, null, 2);
            } catch (error) {
                log('è·å–æ£‹ç›˜çŠ¶æ€å¤±è´¥: ' + error.message, 'error');
            }
        }

        // CAPTCHA functions
        function refreshCaptcha() {
            if (!currentCaptchaId) return;
            document.getElementById('captchaImage').src = tetris.getCaptchaImageUrl(currentCaptchaId) + '&t=' + Date.now();
        }

        async function submitCaptcha() {
            const code = document.getElementById('captchaInput').value.trim();
            if (!code || code.length !== 4) {
                document.getElementById('captchaError').textContent = 'è¯·è¾“å…¥4ä½éªŒè¯ç ';
                return;
            }
            
            try {
                const result = await tetris.submitCaptcha(currentCaptchaId, code);
                if (result.success) {
                    document.getElementById('captchaSection').classList.remove('active');
                    log('éªŒè¯ç éªŒè¯æˆåŠŸï¼', 'success');
                    refreshState();
                } else {
                    document.getElementById('captchaError').textContent = 'éªŒè¯ç é”™è¯¯ï¼Œè¯·é‡è¯•';
                    log('éªŒè¯ç éªŒè¯å¤±è´¥', 'error');
                }
            } catch (error) {
                document.getElementById('captchaError').textContent = error.message;
                log('éªŒè¯ç éªŒè¯å¤±è´¥: ' + error.message, 'error');
            }
        }

        // Set up event listeners
        function setupEventListeners() {
            // Game over event
            tetris.on('gameOver', (data) => {
                log(`ğŸ® æ¸¸æˆç»“æŸï¼å¾—åˆ†: ${data.score}, æ’å: #${data.rank}`, 'success');
                refreshState();
            });

            // Score update event
            tetris.on('scoreUpdate', (data) => {
                log(`ğŸ“Š åˆ†æ•°: ${data.score}, ç­‰çº§: ${data.level}, æ¶ˆé™¤: ${data.linesCleared}è¡Œ`, 'info');
            });

            // CAPTCHA required event
            tetris.on('captchaRequired', (data) => {
                log('âš ï¸ éœ€è¦äººæœºéªŒè¯ï¼', 'warning');
                refreshState();
            });

            // CAPTCHA verified event
            tetris.on('captchaVerified', (data) => {
                log('âœ… éªŒè¯ç éªŒè¯æˆåŠŸï¼Œæ¸¸æˆç»§ç»­ï¼', 'success');
            });

            // Game paused event
            tetris.on('gamePaused', (data) => {
                log('â¸ï¸ æ¸¸æˆå·²æš‚åœ', 'warning');
            });

            // Game resumed event
            tetris.on('gameResumed', (data) => {
                log('â–¶ï¸ æ¸¸æˆå·²ç»§ç»­', 'success');
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (!isSdkReady) return;
            
            switch (e.key.toLowerCase()) {
                case 'q': moveLeft(); break;
                case 'e': moveRight(); break;
                case 's': moveDown(); break;
                case 'w': rotate(); break;
                case ' ': 
                    e.preventDefault(); 
                    hardDrop(); 
                    break;
                case 'enter': startGame(); break;
                case 'escape': endGame(); break;
                case 'p': pauseGame(); break;
            }
        });

        // Auto-refresh state every 2 seconds
        setInterval(() => {
            if (isSdkReady) {
                refreshState();
            }
        }, 2000);

        // Auto-play demo mode
        let autoPlayInterval = null;
        
        async function startAutoPlay() {
            if (!isSdkReady) {
                log('è¯·å…ˆåˆå§‹åŒ– SDK', 'error');
                return;
            }
            
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
                document.getElementById('startAutoPlayBtn').textContent = 'è‡ªåŠ¨æ¼”ç¤º';
                log('è‡ªåŠ¨æ¼”ç¤ºå·²åœæ­¢', 'info');
                return;
            }
            
            document.getElementById('startAutoPlayBtn').textContent = 'åœæ­¢æ¼”ç¤º';
            log('å¼€å§‹è‡ªåŠ¨æ¼”ç¤º...', 'info');
            
            autoPlayInterval = setInterval(async () => {
                try {
                    const state = await tetris.getGameState();
                    
                    if (state.status !== 'playing') {
                        return; // Wait for game to start
                    }
                    
                    if (state.captchaRequired) {
                        return; // Skip during CAPTCHA
                    }
                    
                    // Random movement for demo
                    const actions = ['left', 'right', 'down', 'rotate'];
                    const action = actions[Math.floor(Math.random() * actions.length)];
                    
                    switch (action) {
                        case 'left': await tetris.moveLeft(); break;
                        case 'right': await tetris.moveRight(); break;
                        case 'down': await tetris.moveDown(); break;
                        case 'rotate': await tetris.rotate(); break;
                    }
                } catch (e) {
                    // Ignore errors in auto-play
                }
            }, 300);
        }

        // Initial setup
        log('é¡µé¢åŠ è½½å®Œæˆï¼Œè¯·ç‚¹å‡»"åˆå§‹åŒ– SDK"æŒ‰é’®å¼€å§‹', 'info');
    </script>
</body>
</html>
