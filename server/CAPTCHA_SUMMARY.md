# 验证码频率配置 - 完整指南

## 📚 文档导航

我已经为你创建了完整的验证码配置文档系统，根据你的需求选择查看：

### 🎯 快速开始
- **[CAPTCHA_QUICK_CONFIG.md](./server/CAPTCHA_QUICK_CONFIG.md)** - 5个预设方案，复制粘贴即可
  - 适合：想快速调整配置的人
  - 时间：5分钟

### 📖 详细说明
- **[CAPTCHA_CONFIG.md](./server/CAPTCHA_CONFIG.md)** - 完整的配置参数说明
  - 适合：想深入了解每个参数的人
  - 时间：15分钟

### 📊 方案对比
- **[CAPTCHA_COMPARISON.md](./server/CAPTCHA_COMPARISON.md)** - 各方案效果对比
  - 适合：想数据化决策的人
  - 时间：10分钟

---

## ⚡ 30秒快速配置

### 我想让验证码几乎不出现

```javascript
// 编辑 server/captcha.js 第 9 行
challengeProbability: 0.01  // 改为 0.01

// 或者更彻底（只在作弊时出现）
challengeProbability: 0     // 改为 0
```

### 我想让验证码更频繁

```javascript
// 编辑 server/captcha.js 第 9 行
challengeProbability: 0.10  // 改为 0.10 或更高
```

### 我想完全禁用验证码

```javascript
// 编辑 server/captcha.js 第 122 行的函数
function shouldTriggerCaptcha() {
  return false;  // 添加这一行，直接返回false
}
```

**记得重启服务器！**
```bash
# 按 Ctrl+C 停止
cd /Users/lvqier/hackson-260116/server
node server.js
```

---

## 🎮 配置方案速查表

| 你的需求 | 基础概率设置 | 适用场景 | 用户体验 | 防作弊效果 |
|---------|------------|---------|---------|-----------|
| 几乎不打扰用户 | `0.01` | 休闲游戏 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| **平衡体验和安全（推荐）** | **`0.05`** | **通用** | **⭐⭐⭐⭐** | **⭐⭐⭐⭐** |
| 强力防作弊 | `0.15` | 竞技游戏 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 只针对作弊者 | `0` | 体验优先 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| 测试开发 | 禁用函数 | 开发环境 | ⭐⭐⭐⭐⭐ | 无 |

---

## 🔍 当前配置查看

你的游戏当前使用的配置：

```javascript
// 文件位置：server/captcha.js
const CAPTCHA_CONFIG = {
  challengeProbability: 0.05  // 5% 基础概率
};

// 分数加成：每500分增加2%，最多10%
// 违规惩罚：每次违规增加5%
```

**这意味着**：
- 新手玩家：每20次消行遇到约1次
- 高分玩家：每10次消行遇到约1次
- 作弊玩家：3-5次消行遇到约1次

---

## 📈 验证码触发频率计算器

### 公式

```
总概率 = 基础概率 + 分数加成 + 违规加成

分数加成 = min(10%, floor(分数/500) × 2%)
违规加成 = 违规次数 × 5%
```

### 示例计算

**玩家1：新手，0分，无违规**
```
总概率 = 5% + 0% + 0% = 5%
预期频率 = 每20次消行1次
```

**玩家2：中级，1000分，无违规**
```
总概率 = 5% + 4% + 0% = 9%
预期频率 = 每11次消行1次
```

**玩家3：高手，3000分，无违规**
```
总概率 = 5% + 10% + 0% = 15%
预期频率 = 每7次消行1次
```

**玩家4：作弊者，1000分，3次违规**
```
总概率 = 5% + 4% + 15% = 24%
预期频率 = 每4次消行1次
```

---

## 🛠️ 修改步骤（详细版）

### 步骤1：打开配置文件

```bash
cd /Users/lvqier/hackson-260116/server
nano captcha.js
# 或者用你喜欢的编辑器打开
```

### 步骤2：找到配置区域

使用 `Ctrl+W` 搜索 `CAPTCHA_CONFIG`，会跳到第3行

### 步骤3：修改配置

```javascript
const CAPTCHA_CONFIG = {
  length: 4,
  width: 150,
  height: 50,
  fontSize: 30,
  expirationTime: 120000,
  challengeProbability: 0.05  // 👈 在这里修改
};
```

### 步骤4：保存并退出

- 保存：`Ctrl+O`，然后按 `Enter`
- 退出：`Ctrl+X`

### 步骤5：重启服务器

```bash
# 如果服务器正在运行，先停止（Ctrl+C）
node server.js
```

### 步骤6：验证配置

查看启动日志，确认无错误，然后开始游戏测试

---

## 📊 配置效果预览

### 当前配置（5%基础概率）

```
100个玩家玩1局的预期结果：

新手（0-500分）：
  ├─ 遇到验证码：5人（5%）
  ├─ 不遇到：95人
  └─ 平均每人：1次

中级（500-2000分）：
  ├─ 遇到验证码：9人（9%）
  ├─ 不遇到：91人
  └─ 平均每人：2次

高手（2000+分）：
  ├─ 遇到验证码：15人（15%）
  ├─ 不遇到：85人
  └─ 平均每人：3-4次

作弊者（有违规）：
  ├─ 遇到验证码：25人（25%）
  ├─ 不遇到：75人
  └─ 平均每人：4-6次
```

### 如果改为1%（宽松配置）

```
100个玩家玩1局的预期结果：

新手：遇到1人（1%），平均0次
中级：遇到1人（1%），平均0-1次
高手：遇到1人（1%），平均0-1次
作弊者：遇到20人（20%），平均3-5次
```

### 如果改为15%（严格配置）

```
100个玩家玩1局的预期结果：

新手：遇到15人（15%），平均3次
中级：遇到25人（25%），平均5次
高手：遇到35人（35%），平均8-10次
作弊者：遇到50人（50%），平均15次以上
```

---

## ⚠️ 常见问题

### Q1: 修改后没有效果？
**A**: 确保重启了服务器。Node.js 不会自动重载代码。

### Q2: 验证码出现太频繁，用户投诉？
**A**: 将 `challengeProbability` 降低到 `0.01` 或 `0.02`

### Q3: 发现很多作弊者？
**A**: 将 `challengeProbability` 提高到 `0.10` 或 `0.15`

### Q4: 想完全依赖自动检测，不手动验证？
**A**: 设置 `challengeProbability: 0`，只保留违规惩罚

### Q5: 测试时验证码很烦人？
**A**: 临时设置为 `0` 或直接禁用函数，测试完记得改回来

### Q6: 如何查看当前配置是否生效？
**A**: 
```bash
# 查看配置文件
cat server/captcha.js | grep challengeProbability

# 或者在游戏中观察验证码出现频率
```

### Q7: 修改配置会影响已有玩家吗？
**A**: 不会。修改只影响新的游戏行为，不改变历史数据。

### Q8: 可以不同时间段用不同配置吗？
**A**: 可以！查看 [CAPTCHA_COMPARISON.md](./server/CAPTCHA_COMPARISON.md) 的"分时段配置"章节

---

## 🎯 推荐配置策略

### 阶段1：刚上线（前1个月）
```javascript
challengeProbability: 0.02  // 宽松，积累用户
```
**目标**：快速增长用户，降低流失

### 阶段2：稳定期（1-3个月）
```javascript
challengeProbability: 0.05  // 平衡，当前默认
```
**目标**：平衡体验和安全

### 阶段3：成熟期（3个月后）
```javascript
challengeProbability: 0.03  // 适度宽松，留住老玩家
```
**目标**：优化体验，提高忠诚度

### 特殊时期：发现作弊潮
```javascript
challengeProbability: 0.15  // 临时严格
```
**目标**：快速遏制作弊，事后恢复正常

---

## 📱 快速决策指南

**选择困难？回答这3个问题：**

1. **你的游戏重视什么？**
   - 用户体验 → 选 1% 或 0%
   - 公平竞技 → 选 5% 或 15%
   - 两者平衡 → 选 5%（默认）

2. **当前遇到什么问题？**
   - 用户说验证码太多 → 降低到 1-2%
   - 发现很多作弊 → 提高到 10-15%
   - 没什么问题 → 保持 5%

3. **你的游戏类型是？**
   - 休闲益智 → 1% 或 0%
   - 竞技排行 → 5% 或 15%
   - 社交互动 → 0%（只针对作弊）

---

## 🚀 立即开始

**选择你的方案：**

1. 🟢 **保持默认**（不做修改）
   - 配置已经很好，继续使用

2. 🔵 **降低频率**（提升体验）
   - 将第9行改为：`challengeProbability: 0.01`

3. 🟠 **提高频率**（加强防护）
   - 将第9行改为：`challengeProbability: 0.10`

4. 🟣 **只针对作弊**（极致体验）
   - 将第9行改为：`challengeProbability: 0`

5. ⚪ **完全禁用**（测试用）
   - 查看 [CAPTCHA_QUICK_CONFIG.md](./server/CAPTCHA_QUICK_CONFIG.md) 方案5

---

## 📞 需要帮助？

- 查看详细文档：`server/CAPTCHA_CONFIG.md`
- 查看方案对比：`server/CAPTCHA_COMPARISON.md`
- 查看快速配置：`server/CAPTCHA_QUICK_CONFIG.md`

---

## ✅ 配置检查清单

修改配置后，确认以下事项：

- [ ] 已修改 `captcha.js` 文件
- [ ] 已保存文件
- [ ] 已重启服务器
- [ ] 服务器启动无错误
- [ ] 已测试验证码出现频率
- [ ] 符合预期效果
- [ ] 已记录修改原因（建议）

---

**祝你游戏运营顺利！🎮**
