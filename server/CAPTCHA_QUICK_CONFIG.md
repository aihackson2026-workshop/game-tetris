# 验证码频率快速配置

## 🎯 一键配置方案

根据你的需求选择以下配置，复制粘贴到 `server/captcha.js` 中替换相应代码。

---

## 方案1：几乎不出现（推荐给休闲游戏）

**特点**：正常玩家几乎不会遇到验证码，只在严重作弊时才出现

### 修改 captcha.js 第 3-10 行：

```javascript
const CAPTCHA_CONFIG = {
  length: 4,
  width: 150,
  height: 50,
  fontSize: 30,
  expirationTime: 180000,        // 3分钟
  challengeProbability: 0.01     // 1% ⬅️ 很低
};
```

### 修改 captcha.js 第 124-127 行：

```javascript
  // 不使用分数加成
  const scoreProbability = 0;
  
  // 只针对作弊者
  const violationBonus = speedViolations * 0.20;
```

**预期效果**：
- 普通玩家：100次消行可能遇到1次
- 高分玩家：100次消行可能遇到1次
- 作弊玩家：很快遇到

---

## 方案2：偶尔出现（当前配置）

**特点**：平衡体验和安全，适合大多数情况

### 修改 captcha.js 第 3-10 行：

```javascript
const CAPTCHA_CONFIG = {
  length: 4,
  width: 150,
  height: 50,
  fontSize: 30,
  expirationTime: 120000,        // 2分钟
  challengeProbability: 0.05     // 5% ⬅️ 适中
};
```

### 修改 captcha.js 第 124-127 行：

```javascript
  // 分数越高频率越高
  const scoreProbability = Math.min(0.1, Math.floor(currentScore / 500) * 0.02);
  
  // 作弊行为提高频率
  const violationBonus = speedViolations * 0.05;
```

**预期效果**：
- 普通玩家：20次消行遇到1次
- 高分玩家：10次消行遇到1次
- 作弊玩家：3-5次消行遇到1次

---

## 方案3：经常出现（安全优先）

**特点**：高频率验证，最大程度防止作弊

### 修改 captcha.js 第 3-10 行：

```javascript
const CAPTCHA_CONFIG = {
  length: 6,                     // 6位数字 ⬅️ 更难
  width: 180,
  height: 60,
  fontSize: 28,
  expirationTime: 90000,         // 1.5分钟 ⬅️ 更短
  challengeProbability: 0.15     // 15% ⬅️ 很高
};
```

### 修改 captcha.js 第 124-127 行：

```javascript
  // 分数加成更激进
  const scoreProbability = Math.min(0.2, Math.floor(currentScore / 300) * 0.03);
  
  // 违规惩罚更严厉
  const violationBonus = speedViolations * 0.10;
```

**预期效果**：
- 普通玩家：7次消行遇到1次
- 高分玩家：3-4次消行遇到1次
- 作弊玩家：几乎每次都遇到

---

## 方案4：仅针对作弊者（体验最佳）

**特点**：正常玩家永远不会遇到，只有作弊时才触发

### 修改 captcha.js 第 3-10 行：

```javascript
const CAPTCHA_CONFIG = {
  length: 4,
  width: 150,
  height: 50,
  fontSize: 30,
  expirationTime: 120000,
  challengeProbability: 0        // 0% ⬅️ 完全关闭基础概率
};
```

### 修改 captcha.js 第 124-127 行：

```javascript
  // 完全关闭分数加成
  const scoreProbability = 0;
  
  // 大幅提高违规惩罚
  const violationBonus = speedViolations * 0.30;
```

**预期效果**：
- 普通玩家：永远不会遇到
- 高分玩家：永远不会遇到
- 作弊玩家：第1-2次违规就遇到

---

## 方案5：完全禁用（测试用）

**特点**：完全关闭验证码功能

### 修改 captcha.js 第 122-138 行整个函数：

```javascript
// 判断是否应该触发验证码
function shouldTriggerCaptcha(playerId, currentScore, speedViolations) {
  // 完全禁用验证码
  return false;
}
```

**预期效果**：
- 所有玩家：永远不会遇到验证码
- ⚠️ 警告：失去反作弊保护

---

## 🔧 微调参数说明

如果预设方案不完全符合需求，可以单独调整以下参数：

### 参数1：基础触发概率

```javascript
challengeProbability: 0.05  // 5%
```

| 值 | 频率 | 说明 |
|----|------|------|
| 0 | 不出现 | 完全依赖违规触发 |
| 0.01 | 很低 | 100次消行1次 |
| 0.05 | 适中 | 20次消行1次 |
| 0.10 | 较高 | 10次消行1次 |
| 0.20 | 很高 | 5次消行1次 |

### 参数2：分数门槛

```javascript
Math.floor(currentScore / 500)  // 每500分
```

| 值 | 频率 | 说明 |
|----|------|------|
| 1000 | 宽松 | 每1000分增加 |
| 500 | 适中 | 每500分增加 |
| 300 | 严格 | 每300分增加 |
| 0 | 禁用 | 不使用分数加成 |

### 参数3：分数增量

```javascript
* 0.02  // 每次增加2%
```

| 值 | 增幅 | 说明 |
|----|------|------|
| 0.01 | 小 | 每次+1% |
| 0.02 | 适中 | 每次+2% |
| 0.03 | 大 | 每次+3% |
| 0 | 禁用 | 不增加 |

### 参数4：违规惩罚

```javascript
speedViolations * 0.05  // 每次违规增加5%
```

| 值 | 惩罚力度 | 说明 |
|----|---------|------|
| 0.03 | 轻 | 每次+3% |
| 0.05 | 适中 | 每次+5% |
| 0.10 | 重 | 每次+10% |
| 0.20 | 很重 | 每次+20% |

### 参数5：验证码有效期

```javascript
expirationTime: 120000  // 2分钟（毫秒）
```

| 值 | 时长 | 说明 |
|-------|------|------|
| 60000 | 1分钟 | 时间紧迫 |
| 120000 | 2分钟 | 适中 |
| 180000 | 3分钟 | 宽松 |
| 300000 | 5分钟 | 很宽松 |

---

## 📊 配置对比表

| 方案 | 基础概率 | 分数加成 | 违规惩罚 | 适用场景 |
|-----|---------|---------|---------|---------|
| 方案1 | 1% | 无 | 高(20%) | 休闲娱乐 |
| 方案2 | 5% | 中 | 中(5%) | 通用平衡 |
| 方案3 | 15% | 高 | 高(10%) | 竞技排名 |
| 方案4 | 0% | 无 | 很高(30%) | 体验优先 |
| 方案5 | - | - | - | 测试开发 |

---

## 🎮 实际游戏体验

### 低分玩家（0-1000分）

| 方案 | 遇到验证码次数（每局） |
|-----|---------------------|
| 方案1 | 0-1次 |
| 方案2 | 1-2次 |
| 方案3 | 3-5次 |
| 方案4 | 0次 |

### 高分玩家（2000-5000分）

| 方案 | 遇到验证码次数（每局） |
|-----|---------------------|
| 方案1 | 0-1次 |
| 方案2 | 2-4次 |
| 方案3 | 5-10次 |
| 方案4 | 0次 |

### 作弊玩家（有违规行为）

| 方案 | 遇到验证码次数（前10分钟） |
|-----|-------------------------|
| 方案1 | 3-5次 |
| 方案2 | 4-6次 |
| 方案3 | 8-15次 |
| 方案4 | 5-8次 |

---

## ✅ 推荐选择

### 如果你的游戏是...

- 🎮 **休闲益智类** → 选择 **方案1** 或 **方案4**
- 🏆 **竞技排行类** → 选择 **方案2** 或 **方案3**
- 🧪 **开发测试中** → 选择 **方案5**
- ⚖️ **不确定** → 选择 **方案2**（当前默认）

---

## 🔄 修改后的操作

### 1. 停止服务器
在终端按 `Ctrl + C`

### 2. 编辑文件
```bash
nano server/captcha.js
# 或使用你喜欢的编辑器
```

### 3. 保存文件
`Ctrl + O` → `Enter` → `Ctrl + X`

### 4. 重启服务器
```bash
cd /Users/lvqier/hackson-260116/server
node server.js
```

### 5. 验证配置
开始游戏，观察验证码出现频率是否符合预期

---

## 🐛 常见问题

**Q: 修改后没有生效？**
A: 确保重启了服务器（Node.js不会热重载）

**Q: 验证码完全不出现了？**
A: 检查是否设置了 `challengeProbability: 0` 且没有违规行为

**Q: 验证码太频繁了？**
A: 降低 `challengeProbability` 或选择方案1

**Q: 如何临时禁用验证码？**
A: 设置 `challengeProbability: 0` 和所有加成为0

**Q: 如何恢复默认配置？**
A: 选择方案2，或查看备份的原始文件

---

## 📝 记录你的配置

建议在 captcha.js 顶部添加注释记录你的配置：

```javascript
/**
 * 验证码配置
 * 方案：方案X
 * 修改日期：2026-01-15
 * 修改原因：降低验证码频率，提升用户体验
 * 预期效果：普通玩家几乎不遇到验证码
 */
const CAPTCHA_CONFIG = {
  // ...
};
```

这样方便日后回溯和调整！
